package com.yiniu.bi.web.servlet;

import com.yiniu.bi.cache.InitTempUrlService;
import com.yiniu.bi.cache.InitUrlService;
import com.yiniu.bi.dao.IBaseDao;
import com.yiniu.bi.main.MainStart;
import com.yiniu.bi.main.MainTempStart;
import com.yiniu.bi.main.MainThread;
import com.yiniu.bi.model.ProxyInfo;
import com.yiniu.bi.model.UrlSource;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.core.PreparedStatementCreator;
import org.springframework.web.context.WebApplicationContext;
import org.springframework.web.context.support.WebApplicationContextUtils;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.SQLException;

/**
 * //                       _oo0oo_
 * //                      o8888888o
 * //                      88" . "88
 * //                      (| -_- |)
 * //                      0\  =  /0
 * //                    ___/`---'\___
 * //                  .' \\|     |// '.
 * //                 / \\|||  :  |||// \
 * //                / _||||| -:- |||||- \
 * //               |   | \\\  -  /// |   |
 * //               | \_|  ''\---/''  |_/ |
 * //               \  .-\__  '-'  ___/-. /
 * //             ___'. .'  /--.--\  `. .'___
 * //          ."" '<  `.___\_<|>_/___.' >' "".
 * //         | | :  `- \`.;`\ _ /`;.`/ - ` : | |
 * //         \  \ `_.   \_ __\ /__ _/   .-` /  /
 * //     =====`-.____`.___ \_____/___.-`___.-'=====
 * //                       `=---='
 * //
 * //
 * //     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 * //
 * //               佛祖保佑         永无BUG
 * //
 *
 * @author Michael Kong
 * @date 2015/12/23
 */
public class MainStartServlet extends HttpServlet {

    private Logger LOGGER = LoggerFactory
            .getLogger(MainStartServlet.class);

    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        super.doGet(req, resp);
    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        super.doPost(req, resp);
    }

    @Override
    public void init() throws ServletException {
        super.init();
        LOGGER.info("***********************Servlet容器启动！！！");
        /*WebApplicationContext ctx = WebApplicationContextUtils.getWebApplicationContext(this.getServletContext());
        InitUrlService initUrlService = (InitUrlService) ctx.getBean("initUrlService");
        initUrlService.initUrl();
        *//*InitTempUrlService initTempUrlService = (InitTempUrlService) ctx.getBean("initTempUrlService");
        initTempUrlService.initUrl();*//*
        MainStart mainStart = (MainStart) ctx.getBean("mainStart");
        MainTempStart mainTempStart = (MainTempStart) ctx.getBean("mainTempStart");
        //mainStart.start();
        mainTempStart.start();*/
    }

    @Override
    public void destroy() {
        super.destroy();
        LOGGER.info("终止线程");
        MainStart.THREAD_POOL.shutdownNow();
        MainTempStart.THREAD_POOL.shutdownNow();
    }

   /*private void initProxy() {
        MainStart.PROXY_QUEUE.offer(new ProxyInfo("202.106.16.36", 3128));
    }*/

    /*@Override
    public void init() throws ServletException {
        super.init();

        *//*UrlSource u1 = new UrlSource();
        u1.setType("tmall");
        u1.setUrl("https://chaoshi.detail.tmall.com/item.htm?spm=a3204.7084717.2996785438.12.0kz2Hx&id=521377319207&acm=lb-zebra-27746-338480.1003.4.490875&scm=1003.4.lb-zebra-27746-338480.ITEM_521377319207_490875");

        UrlSource u2 = new UrlSource();
        u2.setType("tmall");
        u2.setUrl("https://chaoshi.detail.tmall.com/item.htm?spm=a3204.7084717.1998630275.10.0kz2Hx&id=36504655700&acm=201507200.1003.1.391902&aldid=x9bapxBQ&scm=1003.1.201507200.13_36504655700_391902&pos=6");

        UrlSource u3 = new UrlSource();
        u3.setType("tmall");
        u3.setUrl("https://chaoshi.detail.tmall.com/item.htm?spm=a3204.7084717.1998630277.7.0kz2Hx&id=45650424189&acm=201507202.1003.1.347496&aldid=qwC81E18&scm=1003.1.201507202.13_45650424189_347496&pos=2&skuId=92173951713");

        UrlSource u4 = new UrlSource();
        u4.setType("tmall");
        u4.setUrl("https://chaoshi.detail.tmall.com/item.htm?spm=a3204.7084717.1996784986.9.0kz2Hx&id=44039268064&acm=201506254.1003.1.391876&aldid=ChhABw2q&scm=1003.1.201506254.13_44039268064_391876&pos=2");

        UrlSource u5 = new UrlSource();
        u5.setType("tmall");
        u5.setUrl("https://chaoshi.detail.tmall.com/item.htm?spm=a3204.7084717.1996784290.8.0kz2Hx&id=36398896031&acm=lb-zebra-27746-338455.1003.4.467556&scm=1003.4.lb-zebra-27746-338455.ITEM_36398896031_467556&skuId=36348817021");

        UrlSource u6 = new UrlSource();
        u6.setType("tmall");
        u6.setUrl("https://chaoshi.detail.tmall.com/item.htm?spm=a3204.7084717.1996784291.6.0kz2Hx&id=45558031544&acm=lb-zebra-27746-338378.1003.4.467576&scm=1003.4.lb-zebra-27746-338378.ITEM_45558031544_467576");

        UrlSource u7 = new UrlSource();
        u7.setType("tmall");
        u7.setUrl("https://chaoshi.detail.tmall.com/item.htm?spm=a3204.7084717.1996780494.6.0kz2Hx&id=19081899570&abbucket=_AB-M801_B3&acm=2015062512.1003.1.391838&aldid=4PKzMr1S&abtest=_AB-LR801-PR801&scm=1003.1.2015062512.13_19081899570_391838&pos=1");
*//*

        UrlSource u1 = new UrlSource();
        u1.setType("yhd");
        u1.setUrl("http://item.yhd.com/item/46926933?tc=3.0.5.46926933.2&tp=51.%E6%84%8F%E5%88%A9.124.2.1.L61hOOu-10-C`xUe");

        UrlSource u2 = new UrlSource();
        u2.setType("yhd");
        u2.setUrl("http://item.yhd.com/item/46423505?tc=3.0.5.46423505.3&tp=51.%E5%93%88%E5%A1%94.124.3.1.L61gRc9-10-C`xUe");

        UrlSource u3 = new UrlSource();
        u3.setType("yhd");
        u3.setUrl("http://item.yhd.com/item/51805598?tc=3.0.5.51805598.1&tp=51.%E6%B4%8B%E4%B8%80.124.1.1.L61e^zt-10-C`xUe");

        UrlSource u4 = new UrlSource();
        u4.setType("yhd");
        u4.setUrl("http://item.yhd.com/item/32194877?tc=3.0.5.32194877.3&tp=51.%E5%BA%A7%E5%B1%B1.124.3.1.L61Qffj-10-C`xUe");

        UrlSource u5 = new UrlSource();
        u5.setType("yhd");
        u5.setUrl("http://item.yhd.com/item/4943534?tc=3.0.5.4943534.5&tp=51.%E5%95%AA%E5%95%AA%E9%80%9A.124.5.1.L61P`ag-10-C`xUe");

        UrlSource u6 = new UrlSource();
        u6.setType("yhd");
        u6.setUrl("http://item.yhd.com/item/7085910?tc=3.0.5.7085910.1&tp=51.%E6%B3%B0%E7%91%9E.124.1.1.L61vqhD-10-C`xUe");

        UrlSource u7 = new UrlSource();
        u7.setType("yhd");
        u7.setUrl("http://item.yhd.com/item/11059993?tc=3.0.5.11059993.1&tp=51.%E5%A6%99%E5%A6%99.124.1.1.L61vW9a-10-C`xUe");

        MainStart.SOURCE_QUEUE.offer(u1);
        MainStart.SOURCE_QUEUE.offer(u2);
        MainStart.SOURCE_QUEUE.offer(u3);
        MainStart.SOURCE_QUEUE.offer(u4);
        MainStart.SOURCE_QUEUE.offer(u5);
        MainStart.SOURCE_QUEUE.offer(u6);
        MainStart.SOURCE_QUEUE.offer(u7);


        System.out.println("***********************Servlet容器启动！！！");
        WebApplicationContext ctx = WebApplicationContextUtils.getWebApplicationContext(this.getServletContext());
        MainStart mainStart = (MainStart) ctx.getBean("mainStart");
        mainStart.start();
        System.out.println("------------------------------------------------");
    }*/
}
